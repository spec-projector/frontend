<jnt-app-page-header [icon]="localUi.icons.modules"
                     title="Modules"
                     i18n-title="@@label.modules"
                     teaser="groups of functions"
                     i18n-teaser="@@message.modules_teaser">
</jnt-app-page-header>

<ng-template #emptyDataTemplate>
  <jnt-message>
    <jnt-stack>
      <ng-container [ngSwitch]="consts.language">
        <ng-container *ngSwitchDefault>
          <p>Features could be grouped by similar applying area.</p>
          <p>E.g. an actor <b>Client</b> wants <b>Register</b>, <b>Login</b>,
            <b>Restore password</b>.</p>
          <p>These features can be grouped by module <b>User Accounts</b>.</p>
        </ng-container>
        <ng-container *ngSwitchCase="language.ru">
          <p>Функции могут быть сгруппированы по области реализации.</p>
          <p>Например <b>Клиент</b> хочет <b>Зарегистрироваться</b>, <b>Войти</b>,
            <b>Восстановить пароль</b>.</p>
          <p>Эти функции могут быть сгруппированы по модулю <b>Учетные записи пользователей</b>.</p>
        </ng-container>
      </ng-container>
      <jnt-button *ngIf="(manager.mode$ | async) === editMode.edit"
                  [icon]="ui.icons.add"
                  text="Add first module"
                  i18n-text="@@action.add_first_module"
                  (click)="addModule()"></jnt-button>
    </jnt-stack>
  </jnt-message>

  <img data-art src="assets/images/modules.svg">
</ng-template>

<jnt-row>
  <jnt-col [desktop]="8">
    <jnt-stack cdkDropList *ngIf="spec.modules.length > 0; else emptyDataTemplate"
               [align]="ui.align.stretch"
               (cdkDropListDropped)="moveModule($event)"
               [cdkDropListData]="spec.modules">
      <jnt-card cdkDrag *ngFor="let module of spec.modules; let i = index; trackBy: trackModule"
                [color]="ui.color.purpleLight">
        <jnt-stack [orientation]="ui.orientation.horizontal">
          <jnt-button cdkDragHandle
                      [icon]="ui.icons.expand"
                      [size]="ui.size.tiny"
                      [shape]="ui.shape.circle"
                      [scheme]="ui.scheme.secondary">
          </jnt-button>
          <spec-module data-module [module]="module"
                       [mode]="added === module.id ? editMode.edit : editMode.view"
                       (updated)="cd.detectChanges()"></spec-module>
        </jnt-stack>

        <ng-template #cardActionsTemplate *ngIf="(manager.mode$ | async) === editMode.edit" let-hide="hide">
          <jnt-menu [orientation]="ui.orientation.vertical">
            <jnt-menu-item [icon]="ui.icons.delete"
                           title="Delete"
                           i18n-title="@@action.delete"
                           (click)="hide()"
                           [jntModal]="{content: deleteTemplate}">
            </jnt-menu-item>
          </jnt-menu>
        </ng-template>

        <ng-template #deleteTemplate>
          <jnt-confirm message="Are you sure to delete?"
                       i18n-message="@@message.are_you_sure_delete"
                       (cancel)="modal.close()"
                       (ok)="deleteModule(module)"></jnt-confirm>
        </ng-template>
      </jnt-card>
      <jnt-card *ngIf="(manager.mode$ | async) === editMode.edit"
                [color]="ui.color.green"
                [padding]="ui.gutter.large">
        <div data-add>
          <jnt-row>
            <jnt-col [tablet]="6">
              <jnt-skeleton [type]="ui.skeleton.type.text" [animated]="false"></jnt-skeleton>
            </jnt-col>
            <jnt-col [tablet]="6"></jnt-col>
            <jnt-col *ngFor="let i of (6 | mockArray)" [tablet]="4">
              <jnt-skeleton [type]="ui.skeleton.type.card" [animated]="false"></jnt-skeleton>
            </jnt-col>
          </jnt-row>
          <jnt-button data-button text="Add module"
                      i18n-text="@@action.add_module"
                      [icon]="ui.icons.add"
                      [size]="ui.size.large"
                      (click)="addModule()"></jnt-button>
        </div>
      </jnt-card>
    </jnt-stack>
  </jnt-col>
  <jnt-col [tablet]="4">
    <jnt-accordion data-library>
      <jnt-accordion-section title="Features">
        <ng-template #accordionContentTemplate>
          <ng-container *ngFor="let actor of spec.actors">
            <p>{{actor.name}}</p>
            <jnt-stack cdkDropList [cdkDropListConnectedTo]="spec | modulesIds"
                       [orientation]="ui.orientation.horizontal"
                       [wrap]="ui.wrap.wrap"
                       [spacing]="ui.gutter.normal">
              <ng-container *ngFor="let feature of actor.features">
                <div cdkDrag *ngIf="!feature.module"
                     [cdkDragData]="feature">
                  {{feature.title}}
                </div>
              </ng-container>
            </jnt-stack>
          </ng-container>
        </ng-template>
      </jnt-accordion-section>

      <jnt-accordion-section title="Model">
        <ng-template #accordionContentTemplate>
          <p>Entities</p>
          <jnt-stack cdkDropList [cdkDropListConnectedTo]="spec | modulesIds"
                     [orientation]="ui.orientation.horizontal"
                     [wrap]="ui.wrap.wrap"
                     [spacing]="ui.gutter.normal">
            <ng-container *ngFor="let entity of spec.model.entities">
              <div cdkDrag *ngIf="!entity.module"
                   [cdkDragData]="entity">
                {{entity.title}}
              </div>
            </ng-container>
          </jnt-stack>
          <p>Enums</p>
          <jnt-stack cdkDropList [cdkDropListConnectedTo]="spec | modulesIds"
                     [orientation]="ui.orientation.horizontal"
                     [wrap]="ui.wrap.wrap"
                     [spacing]="ui.gutter.normal">
            <ng-container *ngFor="let enum of spec.model.enums">
              <div cdkDrag *ngIf="!enum.module"
                   [cdkDragData]="enum">
                {{enum.title}}
              </div>
            </ng-container>
          </jnt-stack>
        </ng-template>
      </jnt-accordion-section>
    </jnt-accordion>
  </jnt-col>
</jnt-row>
